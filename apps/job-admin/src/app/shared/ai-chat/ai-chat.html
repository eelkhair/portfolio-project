<!-- Floating button -->
<button
  class="chat-fab"
  (click)="toggle()"
  [class.chat-fab-open]="isOpen()">
  @if (isOpen()) {
    <i class="pi pi-times"></i>
  } @else {
    <i class="pi pi-sparkles"></i>
    <span class="chat-fab-label">AI Chat</span>
  }
</button>

<!-- Chat window -->
@if (isOpen()) {
  <div class="chat-window">
    <div class="chat-header">
      <i class="pi pi-sparkles"></i>
      <span>AI Assistant</span>
    </div>

    <div class="chat-messages" #messagesContainer>
      @for (msg of messages(); track $index) {
        <div class="chat-message" [class.user]="msg.role === 'user'" [class.assistant]="msg.role === 'assistant'">
          <div class="message-content">{{ msg.content }}</div>
        </div>
      }
      @if (loading()) {
        <div class="chat-message assistant">
          <div class="message-content typing-indicator">
            <span></span><span></span><span></span>
          </div>
        </div>
      }
    </div>

    <div class="chat-input">
      <input
        #chatInput
        pInputText
        [(ngModel)]="message"
        placeholder="Type a message..."
        (keydown)="onKeydown($event)"
        [disabled]="loading()"
        class="w-full" />
      <p-button
        icon="pi pi-send"
        (onClick)="send()"
        [disabled]="!message.trim() || loading()">
      </p-button>
    </div>
  </div>
}
